<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ page.title }} | Project Archive</title>
    <link
      rel="stylesheet"
      href="{{ '/assets/css/style.css' | relative_url }}"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
      rel="stylesheet"
    />
  </head>
  <body
    class="flex h-screen flex-col overflow-hidden md:flex-row"
    {%
    if
    page.year
    %}data-page-year="{{ page.year }}"
    {%
    endif
    %}
  >
    <!-- Mobile Menu Toggle Button -->
    <button
      id="mobile-menu-toggle"
      class="bg-var-secondary border-var-primary hover-bg-var shadow-var fixed left-4 top-4 z-50 flex border-2 p-2 active:translate-y-1 active:shadow-none md:hidden"
      aria-label="Toggle menu"
    >
      <span class="material-symbols-outlined text-var-primary">menu</span>
    </button>

    <!-- Mobile Overlay -->
    <div
      id="mobile-overlay"
      class="pointer-events-none invisible fixed inset-0 z-40 bg-black bg-opacity-50 opacity-0 transition-opacity duration-300 md:hidden"
    ></div>

    <!-- Sidebar -->
    <aside
      id="sidebar"
      class="sidebar fixed z-40 flex h-full w-full max-w-xs -translate-x-full flex-col border-r-2 transition-transform duration-300 ease-in-out md:static md:z-10 md:w-64 md:max-w-none md:translate-x-0"
    >
      <div
        class="border-var-primary sidebar-header flex items-center justify-between border-b-2 p-4"
      >
        <div class="sidebar-content min-w-0 flex-1">
          <h1
            class="sidebar-title text-var-primary mb-0 text-xl uppercase tracking-widest"
          >
            Archive
          </h1>
        </div>
        <div class="flex items-center gap-2">
          <button
            id="dark-mode-toggle"
            class="hover-bg-var text-var-primary flex flex-shrink-0 touch-manipulation rounded p-2"
            aria-label="Toggle dark mode"
          >
            <span class="material-symbols-outlined">dark_mode</span>
          </button>
          <button
            id="sidebar-toggle"
            class="hover-bg-var text-var-primary flex flex-shrink-0 touch-manipulation rounded p-2"
            aria-label="Toggle sidebar"
          >
            <span class="material-symbols-outlined">menu_open</span>
          </button>
        </div>
      </div>

      <nav class="flex-1 space-y-1 overflow-y-auto p-2">
        <a
          href="{{ '/' | relative_url }}"
          class="nav-link {% if page.url == '/' %}nav-link-active font-bold{% endif %} block flex touch-manipulation items-center gap-2 p-3"
          onclick="closeMobileSidebar()"
        >
          <span
            class="material-symbols-outlined flex-shrink-0 align-middle text-sm"
            >home</span
          >
          <span class="sidebar-text">> Index</span>
        </a>
        <div
          class="border-var-secondary sidebar-text my-2 border-t border-dashed"
        ></div>

        {% assign sorted_batches = site.batches | sort: 'year' | reverse %} {%
        assign years = sorted_batches | map: 'year' | uniq %} {% for year in
        years %}
        <div class="sidebar-year-group">
          <button
            class="year-toggle hover-bg-var relative mb-1 mt-2 flex w-full touch-manipulation items-center justify-between rounded px-2 py-1 text-xs uppercase"
            data-year="{{ year }}"
            aria-expanded="true"
            aria-label="Toggle {{ year }} batches"
          >
            <span class="sidebar-text flex items-center">
              <span
                class="material-symbols-outlined year-chevron mr-1 text-sm transition-transform duration-200"
                >expand_more</span
              >
              <span class="year-number">{{ year }}</span>
            </span>
            <span class="year-number-collapsed">{{ year }}</span>
          </button>
          <div class="year-batches" data-year="{{ year }}">
            {% assign year_batches = sorted_batches | where: 'year', year |
            sort: 'slug' %} {% for batch in year_batches %}
            <a
              href="{{ batch.url | relative_url }}"
              class="nav-link {% if page.url == batch.url %}nav-link-active font-bold{% endif %} block flex touch-manipulation items-center gap-2 p-3"
              title="{{ batch.title }}"
              onclick="closeMobileSidebar()"
            >
              <span
                class="material-symbols-outlined flex-shrink-0 align-middle text-sm"
                >folder</span
              >
              <span class="sidebar-text">{{ batch.title }}</span>
            </a>
            {% endfor %}
          </div>
        </div>
        {% endfor %}
      </nav>
    </aside>

    <!-- Main Content -->
    <main
      class="bg-var-primary relative flex-1 overflow-y-auto p-4 pt-16 md:p-8 md:pt-4"
    >
      <!-- Background Pattern -->
      <div class="bg-pattern pointer-events-none absolute inset-0"></div>

      <div class="relative m-auto h-full max-w-5xl">{{ content }}</div>
    </main>

    <!-- Embed Modal -->
    <div
      id="embed-modal"
      class="embed-modal fixed inset-0 z-50 hidden items-center justify-center p-4"
    >
      <div
        class="modal-overlay absolute inset-0 bg-black bg-opacity-75"
        onclick="closeEmbedModal()"
      ></div>
      <div
        class="modal-content bg-var-secondary border-var-primary shadow-var-lg relative flex h-[95%] w-full max-w-6xl flex-col border-2"
      >
        <div
          class="modal-header border-var-primary flex items-center justify-between border-b-2 p-4"
        >
          <h2
            id="modal-title"
            class="text-var-primary mb-0 flex items-center gap-2 text-xl font-bold"
          >
            <span class="material-symbols-outlined" id="modal-icon"
              >description</span
            >
            <span id="modal-title-text">Document Viewer</span>
          </h2>
          <div class="flex items-center gap-2">
            <a
              id="modal-external-link"
              href="#"
              target="_blank"
              class="hover-bg-var text-var-primary flex items-center gap-1 rounded p-2 text-sm"
              title="Open in new tab"
            >
              <span class="material-symbols-outlined text-sm">open_in_new</span>
              <span>Open</span>
            </a>
            <button
              onclick="closeEmbedModal()"
              class="hover-bg-var text-var-primary flex rounded p-2"
              aria-label="Close modal"
            >
              <span class="material-symbols-outlined">close</span>
            </button>
          </div>
        </div>
        <div class="modal-body relative flex-1 overflow-hidden">
          <iframe
            id="modal-iframe"
            class="h-full w-full border-0"
            src=""
            title="Document Viewer"
          ></iframe>
          <div
            id="modal-loading"
            class="bg-var-secondary absolute inset-0 flex items-center justify-center"
          >
            <div class="text-center">
              <span
                class="material-symbols-outlined text-var-tertiary animate-spin text-4xl"
              >
                hourglass_empty
              </span>
              <p class="text-var-secondary mt-4">Loading document...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script
      type="module"
      src="{{ '/assets/js/main.js' | relative_url }}"
    ></script>
  </body>
</html>
